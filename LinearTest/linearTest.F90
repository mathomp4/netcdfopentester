program linearTest

   use netcdf
   use hdf5
   use iso_fortran_env

   implicit none

   ! This is the name of the data file we will read.

   character(len=:), allocatable :: filename

   integer :: ncid1,ncid2,ncid3,ncid4,ncid5,ncid6,ncid7,ncid8
   integer :: i, n, error
   integer(hid_t) :: file_id       ! File identifier 

   real :: start, finish

   integer :: arglen

   call get_command_argument(1, length=arglen)
   allocate(character(arglen) :: filename)
   call get_command_argument(1, value=filename)
   if (len_trim(filename) == 0) then
      write (*,*) "ERROR must provide filename"
      stop 2
   end if

   filename = trim(adjustl(filename))

   ! Open the file. 
   N =1000

   !call cpu_time(start)
   !do i = 1, N
      !call checknc( nf90_open(FILE_NAME1, nf90_nowrite, ncid1) )
      !call checknc( nf90_close(ncid1))
   !enddo
   !call cpu_time(finish)
   !print '("nc3 unlimit dim open Time = ",f6.3," seconds.")',finish-start

   call cpu_time(start)
   do i = 1, N
      call checknc( nf90_open(filename, nf90_nowrite, ncid2) )
      call checknc( nf90_close(ncid2))
   enddo
   call cpu_time(finish)
   write (*,*) finish-start

   !call h5open_f(error)
   !call cpu_time(start)
   !do i = 1, N
      !call h5fopen_f(filename, H5F_ACC_RDONLY_F, file_id, error)
      !call checkh5("h5fopen_f", error)

      !call h5fclose_f(file_id, error)
      !call checkh5("h5fclose_f", error)
   !enddo
   !call cpu_time(finish)
   !call h5close_f(error)
   !print '("nc4 unlimit dim open with hdf5 Time = ",f6.3," seconds.")',finish-start

   contains
   subroutine checknc(status)
      integer, intent ( in) :: status
      
      if(status /= nf90_noerr) then 
         print *, trim(nf90_strerror(status))
         stop "Stopped"
      end if
   end subroutine checknc

   subroutine checkh5(string,error)
      character(len=*), intent(in) :: string
      integer, intent(in) :: error
      if (error /= 0) then
         write(*,*) string, " failed with error ", error
         stop "Stopped"
      endif
      return
   end subroutine checkh5

end program linearTest
