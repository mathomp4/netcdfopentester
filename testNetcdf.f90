! This is part of the netCDF package.
! Copyright 2006 University Corporation for Atmospheric Research/Unidata.
! See COPYRIGHT file for conditions of use.

! This is an example which reads some surface pressure and
! temperatures. The data file read by this program is produced
! comapnion program sfc_pres_temp_wr.f90. It is intended to illustrate
! the use of the netCDF fortran 90 API.

! This program is part of the netCDF tutorial:
! http://www.unidata.ucar.edu/software/netcdf/docs/netcdf-tutorial

! Full documentation of the netCDF Fortran 90 API can be found at:
! http://www.unidata.ucar.edu/software/netcdf/docs/netcdf-f90

! $Id: sfc_pres_temp_rd.f90,v 1.7 2006/12/09 18:44:58 russ Exp $

program sfc_pres_temp_rd
  use netcdf
  use hdf5
  implicit none

  ! This is the name of the data file we will read.

  character (len = *), parameter :: FILE_NAME1 = "MERR.nc3"
  character (len = *), parameter :: FILE_NAME2 = "MERR.nc4"
  character (len = *), parameter :: FILE_NAME3 = "MERR.nc5"
  character (len = *), parameter :: FILE_NAME4 = "MERR.nc6"
  character (len = *), parameter :: FILE_NAME5 = "MERR.nc7"

  integer :: ncid1,ncid2,ncid3,ncid4,ncid5,ncid6,ncid7,ncid8
  integer :: i, n, error
  integer(hid_t) :: file_id       ! File identifier 

  real :: start, finish

  ! Open the file. 
  N =1000

 call cpu_time(start)
  do i = 1, N
     call check( nf90_open(FILE_NAME1, nf90_nowrite, ncid1) )
     call check( nf90_close(ncid1))
  enddo
 call cpu_time(finish)
 print '("nc3 unlimit dim open Time = ",f6.3," seconds.")',finish-start

 call cpu_time(start)
  do i = 1, N
     call check( nf90_open(FILE_NAME2, nf90_nowrite, ncid2) )
     call check( nf90_close(ncid2))
  enddo
 call cpu_time(finish)
 print '("nc4 unlimit dim open Time = ",f6.3," seconds.")',finish-start

 call cpu_time(start)
  do i = 1, N
     call check( nf90_open(FILE_NAME3, nf90_nowrite, ncid3) )
     call check( nf90_close(ncid3))
  enddo
 call cpu_time(finish)
 print '("nc5 unlimit dim open Time = ",f6.3," seconds.")',finish-start
 
 call cpu_time(start)
  do i = 1, N
     call check( nf90_open(FILE_NAME4, nf90_nowrite, ncid4) )
     call check( nf90_close(ncid4))
  enddo
 call cpu_time(finish)
 print '("nc6 unlimit dim open Time = ",f6.3," seconds.")',finish-start

 call cpu_time(start)
  do i = 1, N
     call check( nf90_open(FILE_NAME5, nf90_nowrite, ncid5) )
     call check( nf90_close(ncid5))
  enddo
 call cpu_time(finish)
 print '("nc7 unlimit dim open Time = ",f6.3," seconds.")',finish-start

 call h5open_f(error)
 call cpu_time(start)
  do i = 1, N
     call h5fopen_f(FILE_NAME5, H5F_ACC_RDONLY_F, file_id, error)
     call h5fclose_f(file_id, error)
  enddo
 call cpu_time(finish)
 call h5close_f(error)
 print '("nc7 unlimit dim open with hdf5 Time = ",f6.3," seconds.")',finish-start

contains
  subroutine check(status)
    integer, intent ( in) :: status
    
    if(status /= nf90_noerr) then 
      print *, trim(nf90_strerror(status))
      stop "Stopped"
    end if
  end subroutine check  
end program sfc_pres_temp_rd
