.SUFFIXES: .o .f .f90 .F90 .F77 .exe .F .c

.PHONY:
	all clean veryclean

CC = mpicc
FC = mpif90
#FOPTS = -O3 -vec-report0 -ftz -align all -fno-alias  -fPIC -extend_source -fpe0 -fp-model precise  -align dcommons
#COPTS = -g
#FOPTS = -g

BASELIBDIR = /discover/swdev/mathomp4/Baselibs/ESMA-Baselibs-5.0.5/x86_64-unknown-linux-gnu/ifort_17.0.4.196-mpt_2.15/Linux
#BASELIBDIR = /discover/swdev/mathomp4/Baselibs/ESMA-Baselibs-5.0.4-beta25-patch1-HDF110-NC45/x86_64-unknown-linux-gnu/ifort_17.0.4.196-mpt_2.15/Linux
NETCDF_LIBDIR = ${BASELIBDIR}/lib
NETCDF_INCDIR = ${BASELIBDIR}/include/netcdf
HDF5_INCDIR = ${BASELIBDIR}/include/hdf5

LIB_NETCDFC = $(shell $(BASELIBDIR)/bin/nc-config --libs)
LIB_NETCDFF = $(shell $(BASELIBDIR)/bin/nf-config --flibs)
LIB_HDF5F = -L${BASELIBDIR}/lib -lhdf5hl_fortran -lhdf5_hl -lhdf5_fortran -lhdf5

INC_NETCDF = -I$(NETCDF_INCDIR)
INC_HDF5 = -I$(HDF5_INCDIR)

EXEC += testNetcdf.exe
EXEC += testCNetcdf.exe
EXEC += testCNetcdf_bufsize.exe

#VPATH = src

all: $(EXEC)

testNetcdf.exe: testNetcdf.o
	$(FC) $(FOPTS) $^ -o $@ $(LIB_HDF5F) $(LIB_NETCDFF)

testCNetcdf.exe: testCNetcdf.o
	$(CC) $(COPTS) $^ -o $@ $(LIB_NETCDFC)

testCNetcdf_bufsize.exe: testCNetcdf_bufsize.o
	$(CC) $(COPTS) $^ -o $@ $(LIB_NETCDFC)

.c.o:
	$(CC) $(FOPTS) -c $< $(INC_NETCDF) $(INC_HDF5)

.f.o:
	$(FC) $(FOPTS) -c $< $(INC_NETCDF) $(INC_HDF5)

.f90.o:
	$(FC) $(FOPTS) -c $< $(INC_NETCDF) $(INC_HDF5)

.F90.o:
	$(FC) $(FOPTS) -c $< $(INC_NETCDF) $(INC_HDF5)

.F.o:
	$(FC) $(FOPTS) -r8 -c $< 

clean:
	rm -f *.o *.mod core.*

veryclean: clean
	rm -f *.exe
